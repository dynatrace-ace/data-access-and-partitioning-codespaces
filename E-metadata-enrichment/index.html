
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../D-slice-and-dice/">
      
      
        <link rel="next" href="../F-data-access/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>E. Metadata Enrichment - Dynatrace Data Access & Partitioning</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
  <!-- Add scripts that need to run before here -->
  
      
    
  <!-- Add scripts that need to run afterwards here -->
   <!-- TODO: BeforeGoLive: Replace Agentless RUM Snippet
    1. Create an agentless application in Dynatrace from with convention 'dynatrace-wwse/repositoryname'
    2. https://hci34192.apps.dynatrace.com/ui/apps/dynatrace.classic.deploy.agentless/#install/agentless;gtf=-2h;gf=all
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/PLACEHOLDEr/REPLACE_WITH_YOUR_SNIPPET/1234abcd1234abcd_complete.js" crossorigin="anonymous"></script>
    -->
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/1612cf70810/bf81393wlb/7c50bce5c0cc890f_complete.js" crossorigin="anonymous"></script>

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#metadata-enrichment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Dynatrace Data Access &amp; Partitioning" class="md-header__button md-logo" aria-label="Dynatrace Data Access & Partitioning" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dynatrace Data Access & Partitioning
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              E. Metadata Enrichment
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dynatrace-ace/data-access-and-partitioning-codespaces" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Dynatrace Data Access &amp; Partitioning" class="md-nav__button md-logo" aria-label="Dynatrace Data Access & Partitioning" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Dynatrace Data Access & Partitioning
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dynatrace-ace/data-access-and-partitioning-codespaces" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A. Before You Begin
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../B-deploy-codespace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B. Deploy Codespace
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../C-introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C. Lab Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../D-slice-and-dice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    D. Slice & Dice
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    E. Metadata Enrichment
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    E. Metadata Enrichment
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metadata-enrichment" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata Enrichment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metadata Enrichment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Objectives
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🎯 Objectives">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-understand-why-metadata-enrichment-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Understand Why Metadata Enrichment Matters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-explore-enrichment-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Explore Enrichment Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-table" class="md-nav__link">
    <span class="md-ellipsis">
      Summary Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-try-it-out" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Try It Out
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../F-data-access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    F. Data Access
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../G-data-segmentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    G. Data Segmentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../H-data-partitioning-and-cost-allocation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    H. Data Partitioning & Cost Allocation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../I-cleanup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I. Cleanup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../J-learn-more/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    J. Learn More
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../K-develop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K. Develop
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#metadata-enrichment" class="md-nav__link">
    <span class="md-ellipsis">
      Metadata Enrichment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metadata Enrichment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#objectives" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Objectives
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🎯 Objectives">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-understand-why-metadata-enrichment-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Understand Why Metadata Enrichment Matters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-explore-enrichment-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Explore Enrichment Strategies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-table" class="md-nav__link">
    <span class="md-ellipsis">
      Summary Table
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-try-it-out" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Try It Out
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    <span class="md-ellipsis">
      Resources
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>E. Metadata Enrichment</h1>

<h2 id="metadata-enrichment">Metadata Enrichment<a class="headerlink" href="#metadata-enrichment" title="Permanent link">#</a></h2>
<h3 id="objectives">🎯 Objectives<a class="headerlink" href="#objectives" title="Permanent link">#</a></h3>
<p>All participants will enrich observability data (entities, metrics, events, logs, etc.) with metadata fields such as:</p>
<ul>
<li><code>dt.security_context</code></li>
<li><code>dt.cost.costcenter</code></li>
<li><code>dt.cost.product</code><blockquote>
<p>The idea is to explore different enrichment strategies using Kubernetes and understand trade offs between approaches.
If your cluster hasn't been activated yet for the new Kubernetes app, please do that manually.</p>
</blockquote>
</li>
</ul>
<h4 id="step-1-understand-why-metadata-enrichment-matters">Step 1: Understand Why Metadata Enrichment Matters<a class="headerlink" href="#step-1-understand-why-metadata-enrichment-matters" title="Permanent link">#</a></h4>
<p>💡 Enrichment helps with access control, cost allocation, segmentation, and governance. We are trying to make sure that observability data is tagged with meaningful context.</p>
<p><strong>Key Enrichment Targets</strong>:</p>
<ul>
<li>Entities (e.g., services, workloads)</li>
<li>Metrics</li>
<li>Events</li>
<li>Logs</li>
<li>Traces</li>
</ul>
<p><strong>Questions to consider</strong>:</p>
<ul>
<li>What metadata do you need to enrich your data with?</li>
<li>What level of granularity is required - namespace or workload?</li>
<li>Do you want enrichment to be automatic, declarative, or manual?</li>
<li>How will this metadata be used for IAM, cost control, and segmentation?</li>
</ul>
<h4 id="step-2-explore-enrichment-strategies">Step 2: Explore Enrichment Strategies<a class="headerlink" href="#step-2-explore-enrichment-strategies" title="Permanent link">#</a></h4>
<p>Use the guide: <a href="https://dt-rnd.atlassian.net/wiki/spaces/d1coe/pages/1229849653/Enrichment+Kubernetes">Enrichment Kubernetes</a></p>
<p>✅ <strong>Option 1</strong>: Rely on Primary Grail Fields:</p>
<ul>
<li><code>k8s.namespace.name</code></li>
<li><code>k8s.cluster.name</code></li>
</ul>
<table>
<thead>
<tr>
<th>Pros</th>
<th>Cons</th>
<th>Use when</th>
</tr>
</thead>
<tbody>
<tr>
<td>Out-of-the-box (OOTB)</td>
<td>Limited granularity</td>
<td>Quick setup is needed</td>
</tr>
<tr>
<td>No configuration needed</td>
<td>Only namespace-level</td>
<td>Simple IAM and segmentation</td>
</tr>
</tbody>
</table>
<hr />
<p>🟡 <strong>Option 2</strong>: Use <a href="https://docs.dynatrace.com/docs/ingest-from/setup-on-k8s/guides/metadata-automation/k8s-metadata-telemetry-enrichment">Namespace Annotations &amp; Labels</a></p>
<p>How it works? Dynatrace Operator converts namespace-level metadata into enrichment fields.</p>
<table>
<thead>
<tr>
<th>Pros</th>
<th>Cons</th>
<th>Use when</th>
</tr>
</thead>
<tbody>
<tr>
<td>Declarative</td>
<td>Only applies at namespace level</td>
<td>Customer follows cloud-native tagging practices</td>
</tr>
<tr>
<td>Moderate effort</td>
<td>Requires Dynatrace configuration</td>
<td>Needs more flexibility than OOTB fields</td>
</tr>
<tr>
<td>Supports custom Primary Grail Tags</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<hr />
<p>🔴 <strong>Option 3</strong>: Set Manual Pod Annotations</p>
<p><strong>How it works?</strong> Manually add annotations to pod definitions (e.g., in deployment YAML)</p>
<table>
<thead>
<tr>
<th>Pros</th>
<th>Cons</th>
<th>Use when</th>
</tr>
</thead>
<tbody>
<tr>
<td>Maximum granularity (workload-level)</td>
<td>Requires code changes</td>
<td>Need to segregate access or cost at workload level</td>
</tr>
<tr>
<td>Full control over enrichment</td>
<td>Higher effort</td>
<td>Namespace-level granularity is not enough</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="summary-table">Summary Table<a class="headerlink" href="#summary-table" title="Permanent link">#</a></h4>
<table>
<thead>
<tr>
<th>Approach</th>
<th>Effort</th>
<th>Granularity</th>
<th>Flexibility</th>
<th>Best For</th>
</tr>
</thead>
<tbody>
<tr>
<td>Primary Grail Fields</td>
<td>🟢 Low</td>
<td>Namespace</td>
<td>🔴 Limited</td>
<td>Quick IAM &amp; Segments setup</td>
</tr>
<tr>
<td>Namespace Annotations/Labels</td>
<td>🟡 Medium</td>
<td>Namespace</td>
<td>🟡 Moderate</td>
<td>Declarative tagging, cloud-native orgs</td>
</tr>
<tr>
<td>Manual Pod Annotations</td>
<td>🔴 High</td>
<td>Workload</td>
<td>🟢 Maximum</td>
<td>Fine-grained control, cost partitioning</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="step-3-try-it-out">Step 3: Try It Out<a class="headerlink" href="#step-3-try-it-out" title="Permanent link">#</a></h4>
<p>Complete enrichment using all strategies.</p>
<p>In Dynatrace, you can set up policy boundaries for fine-grained restrictions on the data level with the help of <strong>Primary Fields</strong>. By default, you can use <code>k8s.namespace.name</code> and <code>k8s.cluster.name</code>, but sometimes this is not enough and you need a more fine grained way to set up your boundaries. <strong>Primary Grail Tags</strong> will help you with this.</p>
<p><strong>Primary Grail tags are a small set of important, customer selected tags such as Kubernetes labels, AWS/Azure tags, or key organizational attributes that Dynatrace automatically attaches to all raw telemetry data at ingest, using the <code>primary_tags.*</code> prefix. This enrichment enables fast, consistent filtering, grouping, and permission management across all data, without complex joins or proprietary tagging rules. Primary Grail tags are centrally configured and ensure that cloud-native and business-relevant metadata is always available for queries, dashboards, and access control.</strong></p>
<table>
<thead>
<tr>
<th></th>
<th>Primary Grail Field</th>
<th>Primary Grail Tag</th>
</tr>
</thead>
<tbody>
<tr>
<td>What are they?</td>
<td>Well defined OOTB fields for specific technologies</td>
<td>A new tag on all telemetry data</td>
</tr>
<tr>
<td>Purpose</td>
<td>Data level access, here to auto enrich all signals and entities OOTB</td>
<td>Enrichment of all signals including smartscape Nodes</td>
</tr>
</tbody>
</table>
<p><strong>Task 1: Automatic Enrichment via Kubernetes Metadata</strong></p>
<p>So, as we said, Dynatrace automatically enriches telemetry data as well as entities with Kubernetes metadata such as:</p>
<ul>
<li><code>k8s.cluster.name</code></li>
<li><code>k8s.namespace.name</code></li>
</ul>
<p><strong>Explore your customer's tenant to see how this works. Write down your analysis.</strong></p>
<p>Can you fetch entities and filter them by their <code>k8s.cluster.name</code> or <code>k8s.namespace.name</code>? *<strong>*****</strong>__*<strong>*****</strong></p>
<p>Can you fetch all logs and filter them by their <code>k8s.cluster.name</code> or <code>k8s.namespace.name</code>? *<strong>*****</strong>__*<strong>*****</strong></p>
<blockquote>
<p>💡 Tip: This is useful for OOTB IAM and Segment configurations.</p>
</blockquote>
<p>Now, think about a use case where a customer doesn't want to use these default <strong>Primary Grail Fields</strong> for whatever reason - they might not be granular or flexible enough. <strong>What would you do?</strong></p>
<p>If this is not enough and you'd like to go further and you require more configuration possibilities. Let's explore the enrichment strategy at source. You can enrich data by adding custom labels and annotations to your Kubernetes manifests. Dynatrace will pick these up and use them for tagging and filtering.</p>
<hr />
<p><strong>Task 2: Automatic Enrichment via Kubernetes Metadata at Source</strong></p>
<p>You should ultimately enrich your deployment with:</p>
<ul>
<li><code>dt.security_context</code></li>
<li><code>dt.cost.costcenter</code></li>
<li><code>dt.cost.product</code></li>
</ul>
<p>How to do that you might ask? Well... Let's look at how customers manage modern cloud environments. In modern cloud-native environments, cloud tags, Kubernetes labels and namespaces classify systems using various aspects, like cost allocation, access control, application, and owner. In such environments, configuration-as-code principles are well established, including defining such tags as part of the system configuration.</p>
<p>In K8s, annotations and labels are both key-value pairs used to attach metadata to objects like Pods, Services, and Deployments. Customers following cloud-native tagging best practices will define their partitioning with labels &amp; annotations, as follows:</p>
<p><img alt="" src="../img/content/labels-annotations.png" /></p>
<blockquote>
<p>Note that this is still very basic and limited. We'll add more as we go through this lab.</p>
</blockquote>
<p>You can use the K8s Enrichment settings to transform labels &amp; annotations into <code>dt.security_context</code>, <code>dt.cost.costcenter</code>, <code>dt.cost.product</code>.</p>
<ol>
<li>Go to Settings &gt; Topology Model &gt; Grail security context for monitored entities</li>
<li>Filter by <code>dt.entity.cloud_application_namespace</code></li>
<li>Change destination property from Management Zone to <code>dt.security_context</code></li>
</ol>
<blockquote>
<p>This is needed in order for the enrichment to work. If you're wondering how come we already have the labels extracted, you can go to <code>Settings &gt; Cloud and Virtualization &gt; Kubernetes telemetry enrichment</code> and check the rule there. That rule is allowing us to propagate the label to <code>dt.security_context</code>, however, Grail doesn't know about it until we point the topology rule to it.</p>
</blockquote>
<!-- 4. Go to your Kubernetes cluster > Settings > Telemetry Enrichment
5. Add a rule:
  - Metatadata type = Label
  - Source = kubernetes.io/metadata.name
  - Primary grail tag = false
  - Target = `dt.security_context`

All of these steps are required in order to add additional topology enrichment for K8s. In order for the rule to work, we need to keep in mind 2 things:
- After creating or modifying rules, allow up to 45 minutes for the changes to take effect
- Once this time has passed, restart your pods

Please SSH into your VM and restart all pods. You can use this command - `kubectl rollout restart deployment -n easytrade` -->

<p><img alt="" src="../img/content/labels-annotations-settings.png" /></p>
<blockquote>
<p>💡 How it works? The Dynatrace Operator will take care of the enrichment when mutating the pod definition</p>
</blockquote>
<p><img alt="" src="../img/content/labels-annotations-in-action.png" /></p>
<details>
  <summary>DQL</summary>

<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">spans</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">workload</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;loginservice&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="n">start_time</span><span class="p">,</span><span class="w"> </span><span class="n">span</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">workload</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">.</span><span class="n">security_context</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="n">costcenter</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">.</span><span class="n">cost</span><span class="p">.</span><span class="n">product</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="n">start_time</span><span class="w"> </span><span class="k">DESC</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">15</span>
</code></pre></div>

</details>

<hr />
<p><strong>Task 3: Manual Pod Annotation for Granularity</strong></p>
<p>If you need workload-level granularity, manual annotations are required. For example, you want to be more specific on the product and cost center for the loginservice.<!--Check the picture below where our accountservice doesn't have the proper enrichment.--></p>
<blockquote>
<p>💡Note that:</p>
<ul>
<li>Manually set metadata.dynatrace.com pod annotations take precedence over metadata enrichment configurations</li>
</ul>
</blockquote>
<!--![](img/content/before-manual-pod-enrichment.png)-->

<p>Update your deployment manifest by following instructions below:</p>
<ol>
<li>SSH into your VM</li>
<li>Run <code>kubectl edit deployment &lt;deploymentname&gt; -n easytrade</code> and add the annotations under <code>spec &gt; template &gt; metadata</code>. The pod will automatically be restarted and after a few minutes you will see a new one appear in your cluster as well as in the Dynatrace UI.</li>
</ol>
<div class="highlight"><pre><span></span><code>metadata:
  annotations:
    metadata.dynatrace.com/dt.security_context: &quot;easytrade&quot;
    metadata.dynatrace.com/dt.cost.costcenter: &quot;platform&quot;
    metadata.dynatrace.com/dt.cost.product: &quot;loginservice&quot;
</code></pre></div>
<!--![](img/content/after-manual-pod-enrichment-1.png)-->

<blockquote>
<p>Result:</p>
</blockquote>
<p><img alt="" src="../img/content/after-manual-pod-enrichment.png" />
<img alt="" src="../img/content/after-manual-pod-enrichment-1.png" /></p>
<blockquote>
<p>⚠️ Notes</p>
<ul>
<li>Namespace-level enrichment is easier but less granular.</li>
<li>Workload-level enrichment gives full control but requires manual effort.</li>
<li>Without proper annotations, filtering and cost allocation may be limited.</li>
</ul>
</blockquote>
<h3 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">#</a></h3>
<ul>
<li><a href="https://dt-rnd.atlassian.net/wiki/spaces/d1coe/pages/1246757730/2.+Metadata+Enrichment">Metadata Enrichment</a></li>
<li>Keep an eye on the part that talks about Primary Grail Fields and Primary Grail Tags</li>
<li><a href="https://dt-rnd.atlassian.net/wiki/spaces/d1coe/pages/1229849653/Enrichment+Kubernetes">Metadata Enrichment - K8s</a></li>
</ul>
<div class="grid cards">
<ul>
<li><a href="6-data-access.md">Let's continue<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span></a></li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>